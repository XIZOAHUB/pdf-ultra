<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#ffffff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="PDFUltra">
<meta name="description" content="Professional PDF toolkit. Convert, merge, and edit PDFs directly on your device.">
<title>PDF Ultra - Professional Converter</title>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="manifest" href="manifest.json">

<style>
  :root {
    --bg-main: #f8fafc;
    --bg-surface: #ffffff;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --primary: #2563eb;
    --primary-hover: #1d4ed8;
    --primary-light: #eff6ff;
    --danger: #ef4444;
    --success: #10b981;
    --border: #e2e8f0;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 24px;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }

  body {
    background-color: var(--bg-main);
    color: var(--text-main);
    line-height: 1.5;
    overflow-x: hidden;
  }

  /* --- ONBOARDING MODAL (POLICY) --- */
  #onboarding-modal {
    position: fixed; inset: 0;
    background: rgba(15, 23, 42, 0.4);
    backdrop-filter: blur(4px);
    z-index: 9999;
    display: none;
    align-items: center; justify-content: center;
    padding: 20px;
    opacity: 0; transition: opacity 0.3s ease;
  }
  #onboarding-modal.show { display: flex; opacity: 1; }
  .onboarding-card {
    background: var(--bg-surface);
    width: 100%; max-width: 400px;
    border-radius: var(--radius-lg);
    padding: 32px; text-align: center;
    box-shadow: var(--shadow-lg);
    transform: translateY(20px); transition: transform 0.3s ease;
  }
  #onboarding-modal.show .onboarding-card { transform: translateY(0); }
  .onboarding-icon { font-size: 48px; color: var(--primary); margin-bottom: 20px; }
  .onboarding-title { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
  .onboarding-desc { font-size: 14px; color: var(--text-muted); margin-bottom: 24px; text-align: left; line-height: 1.6; }
  .onboarding-desc ul { margin-left: 20px; margin-top: 10px; margin-bottom: 10px;}
  .btn-agree {
    background: var(--primary); color: white; border: none;
    width: 100%; padding: 14px; border-radius: var(--radius-sm);
    font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.2s;
  }
  .btn-agree:hover { background: var(--primary-hover); }

  /* --- HEADER --- */
  header {
    background: var(--bg-surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 24px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
  }
  .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--text-main); }
  .logo i { font-size: 24px; color: var(--primary); }
  .logo-text { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; }

  /* --- APP LAYOUT --- */
  .app-layout {
    display: grid;
    grid-template-columns: 260px 1fr;
    max-width: 1200px; margin: 0 auto;
    min-height: calc(100vh - 65px);
  }

  /* --- SIDEBAR (Desktop) --- */
  .sidebar {
    background: var(--bg-surface);
    border-right: 1px solid var(--border);
    padding: 24px 16px;
  }
  .sidebar-section { margin-bottom: 24px; }
  .sidebar-title { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; padding-left: 12px; }
  .nav-btn {
    display: flex; align-items: center; gap: 12px; width: 100%;
    padding: 10px 12px; border-radius: var(--radius-sm);
    border: none; background: transparent; color: var(--text-muted);
    font-size: 14px; font-weight: 500; text-align: left; cursor: pointer;
    transition: all 0.2s;
  }
  .nav-btn:hover { background: var(--bg-main); color: var(--text-main); }
  .nav-btn.active { background: var(--primary-light); color: var(--primary); font-weight: 600; }
  .nav-btn i { width: 20px; text-align: center; font-size: 16px; }

  /* --- BOTTOM NAV (Mobile) --- */
  .bottom-nav {
    display: none; position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--bg-surface); border-top: 1px solid var(--border);
    padding: 8px 16px; padding-bottom: calc(8px + env(safe-area-inset-bottom));
    z-index: 100; justify-content: space-around;
  }
  .b-nav-item {
    display: flex; flex-direction: column; align-items: center; gap: 4px;
    color: var(--text-muted); background: transparent; border: none;
    font-size: 10px; font-weight: 500; cursor: pointer;
  }
  .b-nav-item i { font-size: 20px; margin-bottom: 2px; }
  .b-nav-item.active { color: var(--primary); }

  /* --- MAIN CONTENT --- */
  .main-content { padding: 32px; padding-bottom: 100px; }

  /* --- UPLOAD ZONE & CAMERA --- */
  .action-row { display: grid; grid-template-columns: 1fr auto; gap: 16px; margin-bottom: 32px; }
  
  .upload-zone {
    background: var(--bg-surface);
    border: 2px dashed var(--border);
    border-radius: var(--radius-md);
    padding: 40px 24px; text-align: center; cursor: pointer;
    transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .upload-zone:hover, .upload-zone.drag-over { border-color: var(--primary); background: var(--primary-light); }
  .upload-icon { font-size: 40px; color: var(--primary); margin-bottom: 16px; }
  .upload-title { font-size: 16px; font-weight: 600; color: var(--text-main); margin-bottom: 8px; }
  .upload-sub { font-size: 13px; color: var(--text-muted); }
  
  .camera-btn-zone {
    background: var(--bg-surface); border: 1px solid var(--border);
    border-radius: var(--radius-md); padding: 20px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; transition: all 0.2s; min-width: 140px;
  }
  .camera-btn-zone:hover { border-color: var(--primary); box-shadow: var(--shadow-sm); color: var(--primary); }
  .camera-btn-zone i { font-size: 32px; margin-bottom: 12px; color: var(--text-muted); transition: color 0.2s;}
  .camera-btn-zone:hover i { color: var(--primary); }
  .camera-btn-zone span { font-size: 13px; font-weight: 600; }

  #file-input, #camera-input { display: none; }

  /* --- FILE INFO BAR --- */
  .file-info-bar {
    display: none; background: var(--bg-surface); border: 1px solid var(--border);
    border-radius: var(--radius-md); padding: 16px; margin-bottom: 24px;
    align-items: center; gap: 16px; box-shadow: var(--shadow-sm);
  }
  .file-info-bar.show { display: flex; }
  .f-icon-wrap {
    width: 48px; height: 48px; background: var(--primary-light); color: var(--primary);
    border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 24px;
  }
  .f-details { flex: 1; overflow: hidden; }
  .f-name { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .f-meta { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
  .btn-clear { background: transparent; border: none; color: var(--text-muted); font-size: 20px; cursor: pointer; padding: 8px; }
  .btn-clear:hover { color: var(--danger); }

  /* --- CONVERSION GRID --- */
  .section-title { font-size: 18px; font-weight: 700; margin-bottom: 16px; color: var(--text-main); }
  .conv-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; margin-bottom: 40px;
  }
  .conv-card {
    background: var(--bg-surface); border: 1px solid var(--border);
    border-radius: var(--radius-md); padding: 20px 16px;
    text-align: center; cursor: pointer; transition: all 0.2s;
  }
  .conv-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: var(--shadow-md); }
  .conv-card.selected { border-color: var(--primary); background: var(--primary-light); box-shadow: 0 0 0 1px var(--primary); }
  .c-icon { font-size: 28px; color: var(--primary); margin-bottom: 12px; }
  .c-title { font-size: 14px; font-weight: 600; color: var(--text-main); margin-bottom: 4px; }
  .c-desc { font-size: 12px; color: var(--text-muted); }

  /* --- CONVERSION PANEL --- */
  .conversion-panel {
    display: none; background: var(--bg-surface); border: 1px solid var(--border);
    border-radius: var(--radius-md); padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow-sm);
  }
  .conversion-panel.show { display: block; }
  .panel-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 16px; }
  .panel-header i { font-size: 20px; color: var(--primary); }
  .panel-header h3 { font-size: 16px; font-weight: 600; }
  
  .options-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .opt-group { display: flex; flex-direction: column; gap: 6px; }
  .opt-label { font-size: 12px; font-weight: 500; color: var(--text-muted); }
  .opt-control {
    padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius-sm);
    font-size: 14px; background: var(--bg-surface); color: var(--text-main); outline: none; transition: border 0.2s;
  }
  .opt-control:focus { border-color: var(--primary); }

  .btn-primary {
    background: var(--primary); color: white; border: none; width: 100%;
    padding: 14px 24px; border-radius: var(--radius-sm); font-size: 15px; font-weight: 600;
    cursor: pointer; transition: background 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-primary:hover { background: var(--primary-hover); }
  .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }

  /* --- PROGRESS & RESULT --- */
  .progress-wrap { display: none; margin-top: 20px; }
  .progress-wrap.show { display: block; }
  .p-bar-bg { background: var(--bg-main); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 8px; }
  .p-bar-fill { background: var(--primary); height: 100%; width: 0%; transition: width 0.3s ease; }
  .p-text { font-size: 12px; color: var(--text-muted); text-align: center; }

  .result-area { display: none; text-align: center; padding: 32px 0; }
  .result-area.show { display: block; }
  .result-icon { font-size: 56px; color: var(--success); margin-bottom: 16px; }
  .result-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
  .result-sub { font-size: 14px; color: var(--text-muted); margin-bottom: 24px; }
  .btn-success { background: var(--success); color: white; border: none; padding: 12px 24px; border-radius: var(--radius-sm); font-size: 14px; font-weight: 600; cursor: pointer; gap: 8px; display: inline-flex; align-items: center;}
  .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); padding: 12px 24px; border-radius: var(--radius-sm); font-size: 14px; font-weight: 600; cursor: pointer; margin-left: 12px;}

  /* --- TOAST --- */
  .toast {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px);
    background: #1e293b; color: white; padding: 12px 24px; border-radius: 30px;
    font-size: 14px; font-weight: 500; opacity: 0; pointer-events: none; transition: all 0.3s ease;
    z-index: 1000; box-shadow: var(--shadow-md); display: flex; align-items: center; gap: 8px;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* --- RESPONSIVE --- */
  .cat-page { display: none; }
  .cat-page.active { display: block; }

  @media (max-width: 768px) {
    .app-layout { grid-template-columns: 1fr; }
    .sidebar { display: none; }
    .bottom-nav { display: flex; }
    .main-content { padding: 20px 16px 100px; }
    .action-row { grid-template-columns: 1fr; gap: 12px; }
    .camera-btn-zone { padding: 16px; flex-direction: row; gap: 12px; justify-content: center; }
    .camera-btn-zone i { margin-bottom: 0; font-size: 24px; }
  }
</style>
</head>
<body>

<div id="onboarding-modal">
  <div class="onboarding-card">
    <i class="fa-solid fa-shield-halved onboarding-icon"></i>
    <h2 class="onboarding-title">Welcome to PDF Ultra</h2>
    <div class="onboarding-desc">
      Before you start, please review our core principles:
      <ul style="text-align: left;">
        <li><strong>100% Private:</strong> All conversions happen locally on your device.</li>
        <li><strong>No Uploads:</strong> Your files are never sent to any external server.</li>
        <li><strong>Native Features:</strong> Use your camera to scan documents directly.</li>
      </ul>
      By tapping below, you agree to our terms of use and privacy policy.
    </div>
    <button class="btn-agree" onclick="acceptPolicy()">Agree & Continue</button>
  </div>
</div>

<div class="toast" id="toast"><i class="fa-solid fa-circle-info"></i> <span id="toast-msg">Message</span></div>

<header>
  <a href="#" class="logo">
    <i class="fa-solid fa-file-pdf"></i>
    <span class="logo-text">PDF Ultra</span>
  </a>
</header>

<div class="app-layout">

  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Convert</div>
      <button class="nav-btn active" data-target="cat-pdf-to" onclick="switchTab('cat-pdf-to', this)"><i class="fa-solid fa-file-export"></i> PDF to Others</button>
      <button class="nav-btn" data-target="cat-to-pdf" onclick="switchTab('cat-to-pdf', this)"><i class="fa-solid fa-file-import"></i> Others to PDF</button>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Tools</div>
      <button class="nav-btn" data-target="cat-tools" onclick="switchTab('cat-tools', this)"><i class="fa-solid fa-toolbox"></i> Edit & Optimize</button>
      <button class="nav-btn" data-target="cat-scan" onclick="switchTab('cat-scan', this)"><i class="fa-solid fa-camera"></i> Scan Document</button>
    </div>
  </aside>

  <nav class="bottom-nav">
    <button class="b-nav-item active" data-target="cat-pdf-to" onclick="switchTab('cat-pdf-to', this)"><i class="fa-solid fa-file-export"></i><span>Export</span></button>
    <button class="b-nav-item" data-target="cat-to-pdf" onclick="switchTab('cat-to-pdf', this)"><i class="fa-solid fa-file-import"></i><span>Create</span></button>
    <button class="b-nav-item" data-target="cat-tools" onclick="switchTab('cat-tools', this)"><i class="fa-solid fa-toolbox"></i><span>Tools</span></button>
    <button class="b-nav-item" data-target="cat-scan" onclick="switchTab('cat-scan', this)"><i class="fa-solid fa-camera"></i><span>Scan</span></button>
  </nav>

  <main class="main-content">

    <div class="action-row">
      <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
        <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
        <div class="upload-title">Choose a file or drag it here</div>
        <div class="upload-sub">Supports PDF, Word, Excel, Images & more</div>
      </div>
      
      <div class="camera-btn-zone" onclick="document.getElementById('camera-input').click()">
        <i class="fa-solid fa-camera"></i>
        <span>Scan to PDF</span>
      </div>
    </div>
    
    <input type="file" id="file-input" accept="*/*" onchange="handleFile(this.files[0])">
    <input type="file" id="camera-input" accept="image/*" capture="environment" onchange="handleCamera(this.files[0])">

    <div class="file-info-bar" id="file-info-bar">
      <div class="f-icon-wrap" id="file-icon"><i class="fa-solid fa-file"></i></div>
      <div class="f-details">
        <div class="f-name" id="file-name-display">document.pdf</div>
        <div class="f-meta" id="file-meta-display">0 KB ‚Ä¢ PDF Document</div>
      </div>
      <button class="btn-clear" onclick="clearFile()"><i class="fa-solid fa-xmark"></i></button>
    </div>

<div id="cat-pdf-to" class="cat-page active">
      <h2 class="section-title">Convert PDF to...</h2>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 8px;">Document Formats</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-docx')">
          <i class="fa-solid fa-file-word c-icon"></i><div class="c-title">Word</div><div class="c-desc">Editable .docx</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-pptx')">
          <i class="fa-solid fa-file-powerpoint c-icon"></i><div class="c-title">PowerPoint</div><div class="c-desc">Slides as .pptx</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-txt')">
          <i class="fa-solid fa-file-lines c-icon"></i><div class="c-title">Text</div><div class="c-desc">Raw .txt file</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-rtf')">
          <i class="fa-solid fa-file-pen c-icon"></i><div class="c-title">RTF</div><div class="c-desc">Rich text format</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Image Formats</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-jpg')">
          <i class="fa-solid fa-file-image c-icon"></i><div class="c-title">JPG</div><div class="c-desc">Standard images</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-png')">
          <i class="fa-solid fa-image c-icon"></i><div class="c-title">PNG</div><div class="c-desc">High-quality images</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-svg')">
          <i class="fa-solid fa-bezier-curve c-icon"></i><div class="c-title">SVG</div><div class="c-desc">Vector graphics</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-extract-img')">
          <i class="fa-solid fa-images c-icon"></i><div class="c-title">Extract Images</div><div class="c-desc">Get all photos</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Data & Web Formats</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-xlsx')">
          <i class="fa-solid fa-file-excel c-icon"></i><div class="c-title">Excel</div><div class="c-desc">Tables to .xlsx</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-csv')">
          <i class="fa-solid fa-file-csv c-icon"></i><div class="c-title">CSV</div><div class="c-desc">Spreadsheet data</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-html')">
          <i class="fa-brands fa-html5 c-icon"></i><div class="c-title">HTML</div><div class="c-desc">Web page view</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-json')">
          <i class="fa-solid fa-file-code c-icon"></i><div class="c-title">JSON / XML</div><div class="c-desc">Developer data</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-epub')">
          <i class="fa-solid fa-book-open c-icon"></i><div class="c-title">EPUB</div><div class="c-desc">eBook format</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Specialized & Pro</h3>
      <div class="conv-grid" style="margin-bottom: 40px;">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-audio')">
          <i class="fa-solid fa-file-audio c-icon"></i><div class="c-title">Audio</div><div class="c-desc">Listen to PDF (MP3)</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-markdown')">
          <i class="fa-brands fa-markdown c-icon"></i><div class="c-title">Markdown</div><div class="c-desc">Export as .md</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-pdfa')">
          <i class="fa-solid fa-file-shield c-icon"></i><div class="c-title">PDF/A</div><div class="c-desc">Archive format</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-extract-fonts')">
          <i class="fa-solid fa-font c-icon"></i><div class="c-title">Extract Fonts</div><div class="c-desc">Get text fonts</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-to-bw')">
          <i class="fa-solid fa-circle-half-stroke c-icon"></i><div class="c-title">Grayscale</div><div class="c-desc">Convert to B&W</div>
        </div>
      </div>
    </div>
    
    
    
    <div id="cat-to-pdf" class="cat-page">
      <h2 class="section-title">Create PDF from...</h2>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 8px;">Images & Camera</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'img-to-pdf')">
          <i class="fa-solid fa-file-image c-icon"></i><div class="c-title">JPG / JPEG</div><div class="c-desc">Photos to PDF</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'img-to-pdf')">
          <i class="fa-solid fa-image c-icon"></i><div class="c-title">PNG Files</div><div class="c-desc">Lossless to PDF</div>
        </div>
        <div class="conv-card" onclick="switchTab('cat-scan')">
          <i class="fa-solid fa-camera c-icon"></i><div class="c-title">Camera Scan</div><div class="c-desc">Scan documents</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Documents & Text</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'txt-to-pdf')">
          <i class="fa-solid fa-file-alt c-icon"></i><div class="c-title">Text File</div><div class="c-desc">TXT to PDF</div>
        </div>
         <div class="conv-card" onclick="selectConversion(this, 'rtf-to-pdf')">
          <i class="fa-solid fa-file-pen c-icon"></i><div class="c-title">RTF File</div><div class="c-desc">Rich Text to PDF</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'docx-to-pdf')">
          <i class="fa-solid fa-file-word c-icon"></i><div class="c-title">Word (DOCX)</div><div class="c-desc">Convert to PDF</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pptx-to-pdf')">
          <i class="fa-solid fa-file-powerpoint c-icon"></i><div class="c-title">PowerPoint</div><div class="c-desc">Slides to PDF</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Web & Data Formats</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'html-to-pdf')">
          <i class="fa-brands fa-html5 c-icon"></i><div class="c-title">HTML File</div><div class="c-desc">Webpage to PDF</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'md-to-pdf')">
          <i class="fa-brands fa-markdown c-icon"></i><div class="c-title">Markdown</div><div class="c-desc">MD format to PDF</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'csv-to-pdf')">
          <i class="fa-solid fa-table c-icon"></i><div class="c-title">Excel / CSV</div><div class="c-desc">Sheets to PDF</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Start Fresh</h3>
      <div class="conv-grid" style="margin-bottom: 40px;">
         <div class="conv-card" onclick="selectConversion(this, 'create-blank-pdf')">
          <i class="fa-solid fa-square-plus c-icon"></i><div class="c-title">Blank PDF</div><div class="c-desc">Create from scratch</div>
        </div>
      </div>
    </div>
    
    
    <div id="cat-tools" class="cat-page">
      <h2 class="section-title">PDF Tools & Editor</h2>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 8px;">Organize & Structure</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-merge')">
          <i class="fa-solid fa-object-group c-icon"></i><div class="c-title">Merge PDF</div><div class="c-desc">Combine multiple files</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-split')">
          <i class="fa-solid fa-scissors c-icon"></i><div class="c-title">Split PDF</div><div class="c-desc">Separate pages</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-remove-pages')">
          <i class="fa-solid fa-file-circle-minus c-icon"></i><div class="c-title">Remove Pages</div><div class="c-desc">Delete specific pages</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-extract-pages')">
          <i class="fa-solid fa-file-export c-icon"></i><div class="c-title">Extract Pages</div><div class="c-desc">Save selected pages</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-reorder')">
          <i class="fa-solid fa-arrow-right-arrow-left c-icon"></i><div class="c-title">Organize</div><div class="c-desc">Reorder pages</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Security & Signatures</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-protect')">
          <i class="fa-solid fa-lock c-icon"></i><div class="c-title">Protect PDF</div><div class="c-desc">Add password</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-unlock')">
          <i class="fa-solid fa-lock-open c-icon"></i><div class="c-title">Unlock PDF</div><div class="c-desc">Remove password</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-watermark')">
          <i class="fa-solid fa-stamp c-icon"></i><div class="c-title">Watermark</div><div class="c-desc">Add text/image stamp</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-sign')">
          <i class="fa-solid fa-signature c-icon"></i><div class="c-title">Sign PDF</div><div class="c-desc">Add e-signature</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Optimize & Fix</h3>
      <div class="conv-grid">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-compress')">
          <i class="fa-solid fa-compress c-icon"></i><div class="c-title">Compress</div><div class="c-desc">Reduce file size</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-flatten')">
          <i class="fa-solid fa-layer-group c-icon"></i><div class="c-title">Flatten PDF</div><div class="c-desc">Make non-editable</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-metadata')">
          <i class="fa-solid fa-tags c-icon"></i><div class="c-title">Edit Metadata</div><div class="c-desc">Change author/title</div>
        </div>
     <div class="conv-card" onclick="selectConversion(this, 'pdf-reverse')">
          <i class="fa-solid fa-arrow-down-up-across-line c-icon"></i><div class="c-title">Reverse PDF</div><div class="c-desc">Invert page order</div>
        </div>
      </div>

      <h3 style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; margin-top: 24px;">Page Manipulation</h3>
      <div class="conv-grid" style="margin-bottom: 40px;">
        <div class="conv-card" onclick="selectConversion(this, 'pdf-rotate')">
          <i class="fa-solid fa-rotate-right c-icon"></i><div class="c-title">Rotate</div><div class="c-desc">Rotate specific pages</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-page-numbers')">
          <i class="fa-solid fa-list-ol c-icon"></i><div class="c-title">Page Numbers</div><div class="c-desc">Add numbering</div>
        </div>
        <div class="conv-card" onclick="selectConversion(this, 'pdf-crop')">
          <i class="fa-solid fa-crop-simple c-icon"></i><div class="c-title">Crop PDF</div><div class="c-desc">Adjust margins</div>
        </div>
      </div>
    </div>

    <div id="cat-scan" class="cat-page">
      <h2 class="section-title">Document Scanner</h2>
      <div style="background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 32px; text-align: center;">
        <i class="fa-solid fa-camera" style="font-size: 48px; color: var(--primary); margin-bottom: 16px;"></i>
        <h3>Native Camera Scanner</h3>
        <p style="color: var(--text-muted); margin-top: 8px; margin-bottom: 24px;">Use your device's camera to take a photo of a document and instantly convert it to a PDF.</p>
        <button class="btn-primary" onclick="document.getElementById('camera-input').click()" style="max-width: 250px; margin: 0 auto;">
          <i class="fa-solid fa-camera"></i> Open Camera
        </button>
      </div>
    </div>

    <div class="conversion-panel" id="conversion-panel">
      <div class="panel-header">
        <i class="fa-solid fa-cog" id="panel-icon"></i>
        <h3 id="panel-title-text">Configure Settings</h3>
      </div>
      <div class="options-grid" id="panel-options"></div>
      
      <button class="btn-primary" id="btn-convert" onclick="doConvert()">
        <i class="fa-solid fa-bolt"></i> Process File
      </button>
      
      <div class="progress-wrap" id="progress-wrap">
        <div class="p-bar-bg"><div class="p-bar-fill" id="progress-bar"></div></div>
        <div class="p-text" id="progress-text">Processing...</div>
      </div>
    </div>

    <div class="result-area" id="result-area">
      <i class="fa-solid fa-circle-check result-icon"></i>
      <div class="result-title">Task Completed!</div>
      <div class="result-sub" id="result-sub">Your file is ready to download.</div>
      <button class="btn-success" onclick="triggerDownload()"><i class="fa-solid fa-download"></i> Download</button>
      <button class="btn-outline" onclick="resetAll()">Process Another</button>
    </div>

  </main>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// ==========================================
// 1. GLOBAL STATE & VARIABLES
// ==========================================

// Stores selected files (supports multiple files)
let currentFiles = [];

// Currently selected conversion type
let currentConversion = null;

// Final output file blob
let resultBlob = null;

// Final output filename
let resultFilename = '';

// File icon mapping
const FILE_ICONS = {
  pdf: 'fa-file-pdf',
  doc: 'fa-file-word',
  docx: 'fa-file-word',
  xls: 'fa-file-excel',
  xlsx: 'fa-file-excel',
  ppt: 'fa-file-powerpoint',
  pptx: 'fa-file-powerpoint',
  jpg: 'fa-file-image',
  jpeg: 'fa-file-image',
  png: 'fa-image',
  txt: 'fa-file-lines',
  csv: 'fa-file-csv',
  default: 'fa-file'
};

// ==========================================
// 2. ONBOARDING & INITIALIZATION
// ==========================================

document.addEventListener("DOMContentLoaded", () => {
  const agreed = localStorage.getItem('pdfultra_agreed');

  // Show onboarding modal if not accepted
  if (!agreed) {
    document.getElementById('onboarding-modal')?.classList.add('show');
  }

  // Register Service Worker safely
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker
      .register('/sw.js')
      .then(() => {
        console.log('Service Worker registered.');
      })
      .catch((err) => {
        console.log('Service Worker registration failed:', err);
      });
  }
});

// Accept policy function
function acceptPolicy() {
  localStorage.setItem('pdfultra_agreed', 'true');

  const modal = document.getElementById('onboarding-modal');
  modal?.classList.remove('show');

  showToast("Welcome to PDF Ultra!");
}
// ==========================================
// 3. UI NAVIGATION (TABS & TOASTS)
// ==========================================

function switchTab(targetId) {
  // Hide all category pages
  document.querySelectorAll('.cat-page').forEach(page => {
    page.classList.remove('active');
  });

  // Show selected page
  const targetPage = document.getElementById(targetId);
  if (targetPage) {
    targetPage.classList.add('active');
  }

  // Remove active state from all nav buttons
  document.querySelectorAll('.nav-btn, .b-nav-item').forEach(btn => {
    btn.classList.remove('active');
  });

  // Activate matching buttons (desktop + mobile)
  document.querySelectorAll(`[data-target="${targetId}"]`).forEach(btn => {
    btn.classList.add('active');
  });

  // Reset conversion panel
  document.getElementById('conversion-panel')?.classList.remove('show');
  document.querySelectorAll('.conv-card').forEach(card => {
    card.classList.remove('selected');
  });

  hideResult();
}


// Toast Notification
function showToast(message) {
  const toast = document.getElementById('toast');
  const toastMsg = document.getElementById('toast-msg');

  if (!toast || !toastMsg) return;

  toastMsg.textContent = message;
  toast.classList.add('show');

  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// ==========================================
// 4. FILE & CAMERA HANDLING
// ==========================================

// Allow multiple file selection
document.getElementById('file-input').multiple = true;


// Drag & Drop Events
function handleDragOver(e) {
  e.preventDefault();
  document.getElementById('upload-zone')?.classList.add('drag-over');
}

function handleDragLeave() {
  document.getElementById('upload-zone')?.classList.remove('drag-over');
}

function handleDrop(e) {
  e.preventDefault();
  document.getElementById('upload-zone')?.classList.remove('drag-over');

  if (e.dataTransfer.files.length > 0) {
    handleFiles(e.dataTransfer.files);
  }
}


// Camera Handler
function handleCamera(file) {
  if (!file) return;

  switchTab('cat-to-pdf');
  handleFiles([file]);

  // Auto-select image to PDF
  setTimeout(() => {
    const card = document.querySelector('[onclick*="img-to-pdf"]');
    if (card) selectConversion(card, 'img-to-pdf');
  }, 300);
}


// Main File Loader
function handleFiles(files) {
  if (!files || files.length === 0) return;

  currentFiles = Array.from(files);
  const mainFile = currentFiles[0];

  const ext = mainFile.name.split('.').pop().toLowerCase();
  const iconClass = FILE_ICONS[ext] || FILE_ICONS.default;
  const size = formatFileSize(mainFile.size);

  // Update icon
  document.getElementById('file-icon').innerHTML =
    `<i class="fa-solid ${iconClass}"></i>`;

  // Update file info
  if (currentFiles.length > 1) {
    document.getElementById('file-name-display').textContent =
      `${currentFiles.length} files selected`;
    document.getElementById('file-meta-display').textContent =
      `Multiple formats ready`;
  } else {
    document.getElementById('file-name-display').textContent =
      mainFile.name;
    document.getElementById('file-meta-display').textContent =
      `${size} ‚Ä¢ ${ext.toUpperCase()}`;
  }

  document.getElementById('file-info-bar')?.classList.add('show');

  showToast(`${currentFiles.length} file(s) loaded`);
  hideResult();
}


// File Size Formatter
function formatFileSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}


// Clear All Files
function clearFile() {
  currentFiles = [];
  currentConversion = null;

  document.getElementById('file-input').value = '';
  document.getElementById('camera-input').value = '';

  document.getElementById('file-info-bar')?.classList.remove('show');
  document.getElementById('conversion-panel')?.classList.remove('show');

  document.querySelectorAll('.conv-card.selected')
    .forEach(card => card.classList.remove('selected'));

  hideResult();
}

// ==========================================
// 5. PROGRESS & RESULT UI
// ==========================================

// Update Progress Bar
function showProgress(percent, text) {
  const wrap = document.getElementById('progress-wrap');
  const bar = document.getElementById('progress-bar');
  const label = document.getElementById('progress-text');

  if (!wrap || !bar || !label) return;

  wrap.classList.add('show');
  bar.style.width = percent + '%';
  label.textContent = text;
}


// Show Final Result
function showResult(message) {
  const resultArea = document.getElementById('result-area');
  const resultSub = document.getElementById('result-sub');

  if (!resultArea || !resultSub) return;

  resultSub.textContent = message;
  resultArea.classList.add('show');

  resultArea.scrollIntoView({
    behavior: 'smooth',
    block: 'nearest'
  });
}


// Hide Result
function hideResult() {
  document.getElementById('result-area')?.classList.remove('show');
}


// Trigger File Download
function triggerDownload() {
  if (!resultBlob) {
    showToast('‚ö†Ô∏è No file to download!');
    return;
  }

  saveAs(resultBlob, resultFilename);
}


// Reset Everything
function resetAll() {
  clearFile();
}
// ==========================================
// 6. TOOL CONFIGURATION (METADATA)
// ==========================================

const CONVERSION_META = {

  // ===============================
  // A. EXPORT (PDF ‚Üí Others)
  // ===============================

  'pdf-to-docx':      { title: 'PDF to Word',        icon: 'fa-file-word',        accept: '.pdf', ext: 'docx' },
  'pdf-to-pptx':      { title: 'PDF to PowerPoint',  icon: 'fa-file-powerpoint',  accept: '.pdf', ext: 'pptx' },
  'pdf-to-txt':       { title: 'PDF to Text',        icon: 'fa-file-lines',       accept: '.pdf', ext: 'txt' },
  'pdf-to-rtf':       { title: 'PDF to RTF',         icon: 'fa-file-pen',         accept: '.pdf', ext: 'rtf' },

  'pdf-to-jpg':       { title: 'PDF to JPG',         icon: 'fa-file-image',       accept: '.pdf', ext: 'zip' },
  'pdf-to-png':       { title: 'PDF to PNG',         icon: 'fa-image',            accept: '.pdf', ext: 'zip' },
  'pdf-to-svg':       { title: 'PDF to SVG',         icon: 'fa-bezier-curve',     accept: '.pdf', ext: 'zip' },
  'pdf-extract-img':  { title: 'Extract Images',     icon: 'fa-images',           accept: '.pdf', ext: 'zip' },

  'pdf-to-xlsx':      { title: 'PDF to Excel',       icon: 'fa-file-excel',       accept: '.pdf', ext: 'xlsx' },
  'pdf-to-csv':       { title: 'PDF to CSV',         icon: 'fa-file-csv',         accept: '.pdf', ext: 'csv' },
  'pdf-to-html':      { title: 'PDF to HTML',        icon: 'fa-html5',            accept: '.pdf', ext: 'html' },
  'pdf-to-json':      { title: 'PDF to JSON',        icon: 'fa-file-code',        accept: '.pdf', ext: 'json' },
  'pdf-to-epub':      { title: 'PDF to EPUB',        icon: 'fa-book-open',        accept: '.pdf', ext: 'epub' },

  'pdf-to-audio':     { title: 'PDF to Audio',       icon: 'fa-file-audio',       accept: '.pdf', ext: 'mp3' },
  'pdf-to-markdown':  { title: 'PDF to Markdown',    icon: 'fa-markdown',         accept: '.pdf', ext: 'md' },
  'pdf-to-pdfa':      { title: 'PDF to PDF/A',       icon: 'fa-file-shield',      accept: '.pdf', ext: 'pdf' },
  'pdf-extract-fonts':{ title: 'Extract Fonts',      icon: 'fa-font',             accept: '.pdf', ext: 'zip' },
  'pdf-to-bw':        { title: 'PDF to Grayscale',   icon: 'fa-circle-half-stroke', accept: '.pdf', ext: 'pdf' },


  // ===============================
  // B. CREATE (Others ‚Üí PDF)
  // ===============================

  'img-to-pdf':       { title: 'Image to PDF',       icon: 'fa-image',            accept: 'image/*', ext: 'pdf', multiple: true },
  'txt-to-pdf':       { title: 'Text to PDF',        icon: 'fa-file-lines',       accept: '.txt', ext: 'pdf' },
  'rtf-to-pdf':       { title: 'RTF to PDF',         icon: 'fa-file-pen',         accept: '.rtf', ext: 'pdf' },
  'docx-to-pdf':      { title: 'Word to PDF',        icon: 'fa-file-word',        accept: '.docx', ext: 'pdf' },
  'pptx-to-pdf':      { title: 'PowerPoint to PDF',  icon: 'fa-file-powerpoint',  accept: '.pptx', ext: 'pdf' },
  'html-to-pdf':      { title: 'HTML to PDF',        icon: 'fa-html5',            accept: '.html', ext: 'pdf' },
  'md-to-pdf':        { title: 'Markdown to PDF',    icon: 'fa-markdown',         accept: '.md', ext: 'pdf' },
  'csv-to-pdf':       { title: 'CSV/Excel to PDF',   icon: 'fa-table',            accept: '.csv,.xlsx', ext: 'pdf' },

  'create-blank-pdf': { title: 'Create Blank PDF',   icon: 'fa-square-plus',      accept: '', ext: 'pdf' },


  // ===============================
  // C. TOOLS (Edit & Optimize)
  // ===============================

  'pdf-merge':        { title: 'Merge PDFs',          icon: 'fa-object-group',      accept: '.pdf', ext: 'pdf', multiple: true },
  'pdf-split':        { title: 'Split PDF',           icon: 'fa-scissors',          accept: '.pdf', ext: 'pdf' },
  'pdf-remove-pages': { title: 'Remove Pages',        icon: 'fa-file-circle-minus', accept: '.pdf', ext: 'pdf' },
  'pdf-extract-pages':{ title: 'Extract Pages',       icon: 'fa-file-export',       accept: '.pdf', ext: 'pdf' },
  'pdf-reorder':      { title: 'Reorder Pages',       icon: 'fa-arrow-right-arrow-left', accept: '.pdf', ext: 'pdf' },

  'pdf-protect':      { title: 'Protect PDF',         icon: 'fa-lock',              accept: '.pdf', ext: 'pdf' },
  'pdf-unlock':       { title: 'Unlock PDF',          icon: 'fa-lock-open',         accept: '.pdf', ext: 'pdf' },
  'pdf-watermark':    { title: 'Add Watermark',       icon: 'fa-stamp',             accept: '.pdf', ext: 'pdf' },
  'pdf-sign':         { title: 'Sign PDF',            icon: 'fa-signature',         accept: '.pdf', ext: 'pdf' },

  'pdf-compress':     { title: 'Compress PDF',        icon: 'fa-compress',          accept: '.pdf', ext: 'pdf' },
  'pdf-flatten':      { title: 'Flatten PDF',         icon: 'fa-layer-group',       accept: '.pdf', ext: 'pdf' },
  'pdf-metadata':     { title: 'Edit Metadata',       icon: 'fa-tags',              accept: '.pdf', ext: 'pdf' },

  'pdf-reverse':      { title: 'Reverse PDF Pages',   icon: 'fa-arrow-down-up-across-line', accept: '.pdf', ext: 'pdf' },
  'pdf-rotate':       { title: 'Rotate PDF',          icon: 'fa-rotate-right',      accept: '.pdf', ext: 'pdf' },
  'pdf-page-numbers': { title: 'Add Page Numbers',    icon: 'fa-list-ol',           accept: '.pdf', ext: 'pdf' },
  'pdf-crop':         { title: 'Crop PDF',            icon: 'fa-crop-simple',       accept: '.pdf', ext: 'pdf' }
};

// ==========================================
// 7. PANEL OPTIONS RENDERING
// ==========================================

const CONVERSION_OPTIONS = {

  'pdf-to-jpg': `
    <div class="opt-group">
      <label class="opt-label">Quality</label>
      <select class="opt-control" id="opt-q">
        <option value="2">Standard</option>
        <option value="3" selected>High Resolution</option>
      </select>
    </div>
  `,

  'pdf-to-png': `
    <div class="opt-group">
      <label class="opt-label">Background</label>
      <select class="opt-control" id="opt-bg">
        <option value="transparent">Transparent</option>
        <option value="white" selected>White</option>
      </select>
    </div>
  `,

  'img-to-pdf': `
    <div class="opt-group">
      <label class="opt-label">Page Size</label>
      <select class="opt-control" id="opt-size">
        <option value="a4" selected>A4 Portrait</option>
        <option value="fit">Fit to Image</option>
      </select>
    </div>
  `,

  'pdf-watermark': `
    <div class="opt-group">
      <label class="opt-label">Watermark Text</label>
      <input type="text" class="opt-control" id="opt-wm" value="CONFIDENTIAL">
    </div>
  `,

  'pdf-protect': `
    <div class="opt-group">
      <label class="opt-label">Set Password</label>
      <input type="password" class="opt-control" id="opt-pass" placeholder="Enter secure password">
    </div>
  `,

  'pdf-unlock': `
    <div class="opt-group">
      <label class="opt-label">Current Password</label>
      <input type="password" class="opt-control" id="opt-unlock-pass" placeholder="Enter password to unlock">
    </div>
  `,

  'pdf-rotate': `
    <div class="opt-group">
      <label class="opt-label">Rotation</label>
      <select class="opt-control" id="opt-rotate">
        <option value="90">90¬∞ Right</option>
        <option value="180">180¬∞ Upside Down</option>
        <option value="270">90¬∞ Left</option>
      </select>
    </div>
  `,

  'pdf-split': `
    <div class="opt-group">
      <label class="opt-label">Extract Page Number</label>
      <input type="number" class="opt-control" id="opt-split-page" value="1" min="1">
    </div>
  `,

  'pdf-remove-pages': `
    <div class="opt-group">
      <label class="opt-label">Pages to Remove (e.g. 1, 3, 5-7)</label>
      <input type="text" class="opt-control" id="opt-remove-pages" placeholder="e.g. 1, 3, 5-7">
    </div>
  `,

  'pdf-metadata': `
    <div class="opt-group">
      <label class="opt-label">Title</label>
      <input type="text" class="opt-control" id="opt-meta-title" placeholder="Document Title">
    </div>
    <div class="opt-group">
      <label class="opt-label">Author</label>
      <input type="text" class="opt-control" id="opt-meta-author" placeholder="Author Name">
    </div>
  `
};

// ==========================================
// 8. SELECT TOOL & OPEN PANEL
// ==========================================
function selectConversion(el, type) {
  // 1. Highlight the selected card
  document.querySelectorAll('.conv-card.selected').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  currentConversion = type;

  const meta = CONVERSION_META[type];
  if (!meta) return;

  // Special check for Blank PDF (doesn't need an input file)
  if(type !== 'create-blank-pdf' && currentFiles.length === 0) {
      showToast('‚ö†Ô∏è Please select or drop a file first!');
      // Scroll up to upload zone
      document.getElementById('upload-zone').scrollIntoView({ behavior: 'smooth' });
      return;
  }

  // 2. Setup File Input based on tool requirement
  document.getElementById('file-input').accept = meta.accept;
  
  // If tool supports multiple files (Merge, Img to PDF), warn user if they only picked one.
  if (meta.multiple && currentFiles.length === 1 && type !== 'img-to-pdf') {
       showToast('üí° Tip: You can select multiple files for this tool!');
  }

  // 3. Update Panel UI
  document.getElementById('panel-icon').className = `fa-solid ${meta.icon}`;
  document.getElementById('panel-title-text').textContent = meta.title;
  
  // Load specific options or default text
  document.getElementById('panel-options').innerHTML = CONVERSION_OPTIONS[type] || '<div class="opt-group"><span class="opt-label">No extra settings required for this tool.</span></div>';

  // 4. Show Panel
  document.getElementById('conversion-panel').classList.add('show');
  document.getElementById('progress-wrap').classList.remove('show');
  hideResult();
  
  // Scroll to panel smoothly
  setTimeout(() => document.getElementById('conversion-panel').scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
}

// ==========================================
// 9. MASTER ROUTER (EXECUTION)
// ==========================================

async function doConvert() {

  // Validation
  if (currentConversion !== 'create-blank-pdf' && currentFiles.length === 0) {
    showToast('‚ö†Ô∏è Please select a file first!');
    return;
  }

  if (!currentConversion) {
    showToast('‚ö†Ô∏è Please select a tool first!');
    return;
  }

  const btn = document.getElementById('btn-convert');
  btn.disabled = true;
  btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';

  showProgress(10, 'Initializing...');
  hideResult();

  try {

    const meta = CONVERSION_META[currentConversion];
    let baseName = currentFiles.length > 0
      ? currentFiles[0].name.replace(/\.[^.]+$/, '')
      : 'document';

    let blob = null;

    // ===============================
    // ROUTING LOGIC
    // ===============================

    if (currentConversion === 'pdf-merge') {
      blob = await doPdfMerge(currentFiles);

    } else if (currentConversion === 'pdf-protect') {
      blob = await doPdfProtect(currentFiles[0]);

    } else if (currentConversion === 'pdf-rotate') {
      blob = await doPdfRotate(currentFiles[0]);

    } else if (currentConversion === 'pdf-watermark') {
      blob = await doPdfWatermark(currentFiles[0]);

    } else if (currentConversion === 'pdf-reverse') {
      blob = await doPdfReverse(currentFiles[0]);

    } else if (currentConversion === 'create-blank-pdf') {
      blob = await doCreateBlankPdf();

    } else if (currentConversion === 'img-to-pdf') {
      blob = await doImgToPdf(currentFiles);

    } else if (currentConversion === 'pdf-to-txt') {
      blob = await doPdfToTxt(currentFiles[0]);

    } else {
      // Placeholder for unimplemented tools
      showProgress(50, 'Feature not fully implemented yet...');
      await new Promise(resolve => setTimeout(resolve, 1000));

      blob = new Blob(
        [`${meta.title} feature is not implemented yet.`],
        { type: 'text/plain' }
      );
    }

    // ===============================
    // FINALIZE RESULT
    // ===============================

    resultFilename = `${baseName}_ultra.${meta.ext}`;
    resultBlob = blob;

    showProgress(100, 'Completed');

    setTimeout(() => {
      document.getElementById('progress-wrap').classList.remove('show');
      showResult('Successfully processed!');
    }, 500);

  } catch (error) {
    console.error(error);
    showToast('‚ùå Error: ' + error.message);
    document.getElementById('progress-wrap').classList.remove('show');
  }

  // Reset button
  btn.disabled = false;
  btn.innerHTML = '<i class="fa-solid fa-bolt"></i> Process File';
}
// ==========================================
// 10. CORE UTILITY FUNCTIONS
// ==========================================

// Read file as DataURL (for images)
async function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = e => resolve(e.target.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}


// Read file as ArrayBuffer (for PDF processing)
async function readFileAsArrayBuffer(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = e => resolve(e.target.result);
    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}


// Setup pdf.js safely
const pdfjsLib = window.pdfjsLib;

if (pdfjsLib) {
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
} else {
  console.error("pdf.js not loaded correctly.");
}
// ==========================================
// 11. TOOL SPECIFIC LOGIC
// ==========================================


// ===============================
// A. TOOLS & EDITING
// ===============================

async function doPdfMerge(files) {
  showProgress(20, 'Creating merged document...');
  const mergedPdf = await PDFLib.PDFDocument.create();

  for (let i = 0; i < files.length; i++) {
    showProgress(20 + ((i / files.length) * 50), `Processing file ${i + 1}/${files.length}...`);

    const ab = await readFileAsArrayBuffer(files[i]);
    const pdf = await PDFLib.PDFDocument.load(ab);

    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
    copiedPages.forEach(page => mergedPdf.addPage(page));
  }

  showProgress(85, 'Saving merged PDF...');
  const pdfBytes = await mergedPdf.save();
  return new Blob([pdfBytes], { type: 'application/pdf' });
}


async function doPdfReverse(file) {
  showProgress(30, 'Reversing page order...');

  const ab = await readFileAsArrayBuffer(file);
  const pdfDoc = await PDFLib.PDFDocument.load(ab);
  const newPdf = await PDFLib.PDFDocument.create();

  const reversedIndices = pdfDoc.getPageIndices().reverse();
  const copiedPages = await newPdf.copyPages(pdfDoc, reversedIndices);
  copiedPages.forEach(page => newPdf.addPage(page));

  showProgress(90, 'Saving reversed PDF...');
  const pdfBytes = await newPdf.save();
  return new Blob([pdfBytes], { type: 'application/pdf' });
}


async function doPdfProtect(file) {
  const password = document.getElementById('opt-pass')?.value;
  if (!password) throw new Error("Please enter a password.");

  showProgress(40, 'Encrypting document...');

  const ab = await readFileAsArrayBuffer(file);
  const pdfDoc = await PDFLib.PDFDocument.load(ab);

  const pdfBytes = await pdfDoc.save({
    userPassword: password,
    ownerPassword: password,
    permissions: { printing: 'highResolution', modifying: false }
  });

  return new Blob([pdfBytes], { type: 'application/pdf' });
}


async function doPdfRotate(file) {
  const degrees = parseInt(document.getElementById('opt-rotate')?.value || '90');

  showProgress(40, 'Rotating pages...');

  const ab = await readFileAsArrayBuffer(file);
  const pdfDoc = await PDFLib.PDFDocument.load(ab);

  pdfDoc.getPages().forEach(page => {
    const current = page.getRotation().angle;
    page.setRotation(PDFLib.degrees(current + degrees));
  });

  const pdfBytes = await pdfDoc.save();
  return new Blob([pdfBytes], { type: 'application/pdf' });
}


async function doPdfWatermark(file) {
  const text = document.getElementById('opt-wm')?.value || 'CONFIDENTIAL';

  showProgress(40, 'Applying watermark...');

  const ab = await readFileAsArrayBuffer(file);
  const pdfDoc = await PDFLib.PDFDocument.load(ab);

  const font = await pdfDoc.embedFont(PDFLib.StandardFonts.HelveticaBold);

  pdfDoc.getPages().forEach(page => {
    const { width, height } = page.getSize();

    page.drawText(text, {
      x: 50,
      y: height / 2,
      size: 40,
      font,
      color: PDFLib.rgb(0.5, 0.5, 0.5),
      opacity: 0.3,
      rotate: PDFLib.degrees(45)
    });
  });

  const pdfBytes = await pdfDoc.save();
  return new Blob([pdfBytes], { type: 'application/pdf' });
}


async function doCreateBlankPdf() {
  showProgress(50, 'Generating blank PDF...');
  const pdfDoc = await PDFLib.PDFDocument.create();
  pdfDoc.addPage([595.28, 841.89]); // A4
  const pdfBytes = await pdfDoc.save();
  return new Blob([pdfBytes], { type: 'application/pdf' });
}


// ===============================
// B. CREATE PDF (Images ‚Üí PDF)
// ===============================

async function doImgToPdf(files) {
  showProgress(20, 'Initializing PDF...');
  const { jsPDF } = window.jspdf;
  let doc = null;

  for (let i = 0; i < files.length; i++) {
    showProgress(20 + ((i / files.length) * 60), `Processing image ${i + 1}/${files.length}...`);

    const dataUrl = await readFileAsDataURL(files[i]);

    const img = new Image();
    await new Promise(res => { img.onload = res; img.src = dataUrl; });

    const w = img.width * 0.264583;
    const h = img.height * 0.264583;
    const orientation = w > h ? 'landscape' : 'portrait';

    if (i === 0) {
      doc = new jsPDF({ orientation, unit: 'mm', format: [w, h] });
    } else {
      doc.addPage([w, h], orientation);
    }

    const imgType = files[i].type === 'image/png' ? 'PNG' : 'JPEG';
    doc.addImage(dataUrl, imgType, 0, 0, w, h);
  }

  showProgress(90, 'Finalizing PDF...');
  return doc.output('blob');
}


// ===============================
// C. EXPORT PDF (PDF ‚Üí TXT)
// ===============================

async function doPdfToTxt(file) {
  showProgress(30, 'Reading PDF...');

  const ab = await readFileAsArrayBuffer(file);
  const pdf = await pdfjsLib.getDocument({ data: new Uint8Array(ab) }).promise;

  let fullText = "";

  for (let i = 1; i <= pdf.numPages; i++) {
    showProgress(30 + ((i / pdf.numPages) * 50), `Extracting page ${i}...`);

    const page = await pdf.getPage(i);
    const textContent = await page.getTextContent();

    const pageText = textContent.items.map(item => item.str).join(' ');
    fullText += `--- Page ${i} ---\n\n${pageText}\n\n`;
  }

  showProgress(90, 'Creating text file...');
  return new Blob([fullText], { type: 'text/plain' });
}
</script>
</body>
</html>
